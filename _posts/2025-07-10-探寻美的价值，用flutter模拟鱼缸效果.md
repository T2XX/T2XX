---
layout: post # ä½¿ç”¨ä¸»é¢˜æä¾›çš„ post å¸ƒå±€
title: ğŸš€ æ¢å¯»ç¾çš„ä»·å€¼ï¼Œç”¨Flutteræ¨¡æ‹Ÿé±¼ç¼¸æ•ˆæœ # æ–‡ç« æ ‡é¢˜
date: 2025-07-10 17:09:00 +0800 # å‘å¸ƒæ—¥æœŸå’Œæ—¶é—´ï¼Œ+0800 æ˜¯ä¸œå…«åŒºæ—¶åŒº
categories: [æŠ€æœ¯, Flutter] # å¯é€‰ï¼šæ–‡ç« åˆ†ç±»ï¼Œå¯ä»¥æœ‰å¤šä¸ª
tags: [Flutter, CustomPainter, åŠ¨ç”», æ•ˆæœ, é±¼ç¼¸, ç¾å­¦] # å¯é€‰ï¼šæ–‡ç« æ ‡ç­¾ï¼Œå¯ä»¥æœ‰å¤šä¸ª
author: Anton # å¯é€‰ï¼šä½œè€…å
excerpt: "æ¢ç´¢å¦‚ä½•åˆ©ç”¨ Flutter çš„ CustomPainter å’ŒåŠ¨ç”»æ•ˆæœï¼Œæ¨¡æ‹Ÿå‡ºé€¼çœŸçš„æ°´æ³¢æ¶Ÿæ¼ªå’Œä¸Šå‡æ°”æ³¡ï¼Œä¸ºä½ çš„åº”ç”¨å¢æ·»ä¸€ä»½å®é™çš„é±¼ç¼¸ç¾å­¦ã€‚" # æ–‡ç« æ‘˜è¦ï¼Œå¦‚æœä½ çš„ index.html ä½¿ç”¨äº† post.excerpt
---
å¦‚ä½•åœ¨ Flutter ä¸­ä½¿ç”¨ `CustomPainter` å’ŒåŠ¨ç”»ç³»ç»Ÿï¼Œæ¨¡æ‹Ÿå‡ºä¸€ä¸ªå……æ»¡ç”Ÿæœºå’Œå®é™çš„â€œé±¼ç¼¸æ•ˆæœâ€â€”â€”åŒ…æ‹¬æ°´æ³¢æ¶Ÿæ¼ªå’Œç¼“æ…¢ä¸Šå‡çš„æ°”æ³¡ï¼Œä¸ºä½ çš„åº”ç”¨å¢æ·»ä¸€ä»½ç‹¬ç‰¹çš„ç¦…æ„ã€‚

### ä½•ä¸º `CustomPainter`ï¼Ÿ

å½“æˆ‘ä»¬éœ€è¦ç»˜åˆ¶éå¸¸è§„çš„ã€åŠ¨æ€çš„ã€åƒç´ çº§çš„ UI æ•ˆæœæ—¶ï¼ŒFlutter å†…ç½®çš„ Widget å¯èƒ½æ— æ³•æ»¡è¶³éœ€æ±‚ã€‚è¿™æ—¶ï¼Œ`CustomPainter` å°±æˆäº†æˆ‘ä»¬çš„æœ€ä½³é€‰æ‹©ã€‚å®ƒå…è®¸æˆ‘ä»¬ç›´æ¥è®¿é—®åº•å±‚çš„ `Canvas` å¯¹è±¡ï¼Œè¿›è¡Œåƒç´ çº§åˆ«çš„ç»˜åˆ¶ï¼Œå®ç°æ— é™çš„åˆ›æ„å¯èƒ½ã€‚

### æ ¸å¿ƒæ„ä»¶ï¼š`RippleEffect` Widget

æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ª `RippleEffect` Widgetï¼Œå®ƒå°†ä½œä¸ºæˆ‘ä»¬æ°´æ³¢å’Œæ°”æ³¡æ•ˆæœçš„å®¹å™¨ã€‚

```dart
import 'dart:math';

import 'package:flutter/material.dart';

class RippleEffect extends StatefulWidget {
  const RippleEffect({Key? key}) : super(key: key);

  @override
  _RippleEffectState createState() => _RippleEffectState();
}

class _RippleEffectState extends State<RippleEffect>
    with SingleTickerProviderStateMixin { // æ··å…¥ SingleTickerProviderStateMixin æä¾› Ticker
  late AnimationController _controller; // åŠ¨ç”»æ§åˆ¶å™¨
  late RipplePainter _painter; // è‡ªå®šä¹‰ç»˜åˆ¶å™¨

  @override
  void initState() {
    super.initState();
    _controller = AnimationController(
      vsync: this, // ç»‘å®š TickerProvider
      duration: const Duration(seconds: 5), // åŠ¨ç”»å‘¨æœŸ5ç§’
    )..repeat(); // å¾ªç¯æ’­æ”¾åŠ¨ç”»
    _painter = RipplePainter(animation: _controller); // åˆå§‹åŒ–ç»˜åˆ¶å™¨ï¼Œä¼ å…¥åŠ¨ç”»
  }

  @override
  void dispose() {
    _controller.dispose(); // é‡Šæ”¾åŠ¨ç”»æ§åˆ¶å™¨èµ„æº
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return IgnorePointer( // å¿½ç•¥æŒ‡é’ˆäº‹ä»¶ï¼Œè®©åº•å±‚Widgetå¯ä»¥æ¥æ”¶ç‚¹å‡»
      child: CustomPaint(size: Size.infinite, painter: _painter), // ä½¿ç”¨CustomPaintè¿›è¡Œç»˜åˆ¶
    );
  }
}
```

è¿™æ®µä»£ç å¾ˆç®€å•ï¼š
1.  `RippleEffect` æ˜¯ä¸€ä¸ª `StatefulWidget`ï¼Œå› ä¸ºå®ƒéœ€è¦ç®¡ç†åŠ¨ç”»çŠ¶æ€ã€‚
2.  `_RippleEffectState` æ··å…¥äº† `SingleTickerProviderStateMixin`ï¼Œè¿™æ˜¯ `AnimationController` æ‰€å¿…éœ€çš„ï¼Œå®ƒæä¾›äº† `vsync` å¯¹è±¡ï¼Œç¡®ä¿åŠ¨ç”»åœ¨å±å¹•åˆ·æ–°æ—¶åŒæ­¥ã€‚
3.  `_controller` æ˜¯ä¸€ä¸ª `AnimationController`ï¼Œè®¾ç½®åŠ¨ç”»æ—¶é•¿ä¸º5ç§’å¹¶å¾ªç¯æ’­æ”¾ (`.repeat()`)ã€‚
4.  `_painter` æ˜¯æˆ‘ä»¬çœŸæ­£è¿›è¡Œç»˜åˆ¶çš„ `CustomPainter` å®ä¾‹ã€‚
5.  `build` æ–¹æ³•è¿”å›ä¸€ä¸ª `IgnorePointer` åŒ…è£¹çš„ `CustomPaint`ã€‚`IgnorePointer` ç¡®ä¿è¿™ä¸ªæ•ˆæœå›¾å±‚ä¸ä¼šé˜»ç¢ç”¨æˆ·ä¸åº•å±‚ UI çš„äº¤äº’ã€‚`Size.infinite` è®© `CustomPaint` å°½å¯èƒ½å æ»¡çˆ¶å®¹å™¨ã€‚

### ç»˜åˆ¶æ ¸å¿ƒï¼š`RipplePainter`

æ‰€æœ‰è§†è§‰æ•ˆæœçš„ç§˜å¯†éƒ½è—åœ¨ `RipplePainter` ä¸­ã€‚å®ƒç»§æ‰¿è‡ª `CustomPainter`ï¼Œå¹¶é‡å†™äº† `paint` æ–¹æ³•æ¥å®šä¹‰ç»˜åˆ¶é€»è¾‘ã€‚

```dart
class RipplePainter extends CustomPainter {
  final Animation<double> animation;
  final List<_Bubble> _bubbles = []; // å­˜å‚¨æ°”æ³¡å¯¹è±¡
  final Random _random = Random(); // éšæœºæ•°ç”Ÿæˆå™¨
  DateTime? _lastUpdateTime; // ç”¨äºè®¡ç®—å¸§ä¹‹é—´çš„æ—¶é—´å·®

  RipplePainter({required this.animation}) : super(repaint: animation); // æ„é€ å‡½æ•°ï¼Œç›‘å¬åŠ¨ç”»å˜åŒ–

  // æ›´æ–°æ°”æ³¡çŠ¶æ€å¹¶ç”Ÿæˆæ–°æ°”æ³¡
  void _updateAndGenerateBubbles(Size size) {
    final now = DateTime.now();
    if (_lastUpdateTime == null) {
      _lastUpdateTime = now;
      return;
    }
    final double dt = now.difference(_lastUpdateTime!).inMilliseconds / 1000.0; // è®¡ç®—ç§’çº§æ—¶é—´å·®
    _lastUpdateTime = now;

    const double spawnRatePerSecond = 1.2; // æ¯ç§’ç”Ÿæˆæ°”æ³¡çš„å¹³å‡é€Ÿç‡
    if (_bubbles.length < 15 &&
        _random.nextDouble() < spawnRatePerSecond * dt) { // æ§åˆ¶æ°”æ³¡æ•°é‡å’Œç”Ÿæˆé¢‘ç‡
      _bubbles.add(
        _Bubble(
          random: _random,
          startX: _random.nextDouble() * size.width, // éšæœºXè½´èµ·å§‹ä½ç½®
          startY: size.height + 20.0, // ä»å±å¹•åº•éƒ¨å¤–20pxå¤„å¼€å§‹
        ),
      );
    }

    for (var bubble in _bubbles) {
      bubble.update(dt); // æ›´æ–°æ¯ä¸ªæ°”æ³¡çš„çŠ¶æ€
    }
    _bubbles.removeWhere((bubble) => bubble.isDead); // ç§»é™¤æ­»äº¡æ°”æ³¡
  }

  @override
  void paint(Canvas canvas, Size size) {
    _updateAndGenerateBubbles(size); // åœ¨æ¯æ¬¡ç»˜åˆ¶å‰æ›´æ–°æ°”æ³¡çŠ¶æ€

    // ç»˜åˆ¶æ°´ä½“å åŠ å±‚ï¼ˆåŠé€æ˜è“è‰²ï¼‰
    final waterOverlayPaint = Paint()
      ..color = const Color(0xFF87CEEB).withValues(alpha: 0.08) // æ·¡è“è‰²ï¼Œé€æ˜åº¦8%
      ..style = PaintingStyle.fill;
    canvas.drawRect(
      Rect.fromLTWH(0, 0, size.width, size.height),
      waterOverlayPaint,
    );

    final effectPaint = Paint()..style = PaintingStyle.stroke; // æ•ˆæœç»˜åˆ¶ç”¨çš„ç”»ç¬”ï¼Œçº¿æ¡†æ¨¡å¼

    // ç»˜åˆ¶ç¬¬ä¸€ä¸ªæ¼©æ¶¡/æ¶Ÿæ¼ªæ•ˆæœ
    _drawSwirl(
      canvas,
      size,
      effectPaint,
      (animation.value + 0.0) % 1.0, // åŠ¨ç”»è¿›åº¦0å¼€å§‹
      0.3, // æ¼©æ¶¡ä¸­å¿ƒXæ¯”ä¾‹
      0.5, // æ¼©æ¶¡ä¸­å¿ƒYæ¯”ä¾‹
    );
    // ç»˜åˆ¶ç¬¬äºŒä¸ªæ¼©æ¶¡/æ¶Ÿæ¼ªæ•ˆæœï¼Œä¸ç¬¬ä¸€ä¸ªé”™å¼€åŠä¸ªå‘¨æœŸ
    _drawSwirl(
      canvas,
      size,
      effectPaint,
      (animation.value + 0.5) % 1.0, // åŠ¨ç”»è¿›åº¦0.5å¼€å§‹
      0.7, // æ¼©æ¶¡ä¸­å¿ƒXæ¯”ä¾‹
      0.4, // æ¼©æ¶¡ä¸­å¿ƒYæ¯”ä¾‹
    );

    _drawBubbles(canvas, effectPaint); // ç»˜åˆ¶æ°”æ³¡
  }

  // ç»˜åˆ¶æ°”æ³¡
  void _drawBubbles(Canvas canvas, Paint paint) {
    paint.maskFilter = null; // æ¸…é™¤æ¨¡ç³Šæ»¤é•œ
    paint.strokeWidth = 1.5; // è®¾ç½®æ°”æ³¡è¾¹æ¡†å®½åº¦

    for (final bubble in _bubbles) {
      if (bubble.opacity <= 0) continue; // å¦‚æœæ°”æ³¡å®Œå…¨é€æ˜ï¼Œåˆ™è·³è¿‡ç»˜åˆ¶
      paint.color = Colors.white.withOpacity(bubble.opacity); // è®¾ç½®æ°”æ³¡é¢œè‰²å’Œé€æ˜åº¦
      canvas.drawCircle(bubble.position, bubble.radius, paint); // ç»˜åˆ¶åœ†å½¢æ°”æ³¡
    }
  }

  // ç»˜åˆ¶æ¼©æ¶¡/æ¶Ÿæ¼ªæ•ˆæœ
  void _drawSwirl(
    Canvas canvas,
    Size size,
    Paint paint,
    double progress, // å½“å‰åŠ¨ç”»è¿›åº¦ (0.0 - 1.0)
    double dx, // ç»˜åˆ¶ä¸­å¿ƒXæ¯”ä¾‹
    double dy, // ç»˜åˆ¶ä¸­å¿ƒYæ¯”ä¾‹
  ) {
    final double easedProgress = Curves.easeOut.transform(progress); // åº”ç”¨ç¼“åŠ¨æ›²çº¿
    final double radius = size.width * 0.4 * easedProgress; // åŠå¾„éšè¿›åº¦å¢å¤§
    final double opacity =
        (1.0 - easedProgress) * (easedProgress * 4).clamp(0.0, 1.0); // é€æ˜åº¦å…ˆå¢å¤§åå‡å°

    if (opacity <= 0) return; // å®Œå…¨é€æ˜åˆ™ä¸ç»˜åˆ¶

    paint.color = Colors.white.withOpacity(opacity * 0.1); // æ¼©æ¶¡é¢œè‰²ä¸ºåŠé€æ˜ç™½è‰²
    paint.strokeWidth = 2.0; // æ¼©æ¶¡çº¿å®½
    paint.maskFilter = const MaskFilter.blur(BlurStyle.normal, 4.0); // åº”ç”¨é«˜æ–¯æ¨¡ç³Šï¼Œè®©æ¼©æ¶¡è¾¹ç¼˜æŸ”å’Œ

    canvas.save(); // ä¿å­˜å½“å‰CanvasçŠ¶æ€
    final center = Offset(size.width * dx, size.height * dy); // è®¡ç®—ç»˜åˆ¶ä¸­å¿ƒç‚¹
    canvas.translate(center.dx, center.dy); // ç§»åŠ¨CanvasåŸç‚¹åˆ°ç»˜åˆ¶ä¸­å¿ƒ
    canvas.rotate(progress * 3.14159 * 0.2); // æ—‹è½¬Canvasï¼Œä½¿æ¼©æ¶¡æœ‰è½»å¾®æ—‹è½¬æ•ˆæœ
    canvas.drawOval( // ç»˜åˆ¶æ¤­åœ†ï¼Œæ¨¡æ‹Ÿæ¶Ÿæ¼ª
      Rect.fromCenter(
        center: Offset.zero,
        width: radius * 1.2, // æ¤­åœ†å®½åº¦
        height: radius * 0.6, // æ¤­åœ†é«˜åº¦
      ),
      paint,
    );
    canvas.restore(); // æ¢å¤Canvasåˆ°ä¿å­˜æ—¶çš„çŠ¶æ€
  }

  @override
  bool shouldRepaint(covariant RipplePainter oldDelegate) {
    // å…³é”®ä¼˜åŒ–ï¼šå› ä¸ºæˆ‘ä»¬åœ¨æ„é€ å‡½æ•°ä¸­æŒ‡å®šäº† super(repaint: animation)ï¼Œ
    // CustomPainter ä¼šåœ¨ animation å‘ç”Ÿå˜åŒ–æ—¶è‡ªåŠ¨è°ƒç”¨ paint æ–¹æ³•ã€‚
    // å› æ­¤ï¼Œè¿™é‡Œè¿”å› false å¯ä»¥é¿å…ä¸å¿…è¦çš„é‡ç»˜æ£€æŸ¥ï¼Œæé«˜æ€§èƒ½ã€‚
    return false;
  }
}
```

`RipplePainter` çš„æ ¸å¿ƒé€»è¾‘åˆ†è§£ï¼š

1.  **æ„é€ å‡½æ•°**: `super(repaint: animation)` æ˜¯ä¸€ä¸ªå…³é”®ä¼˜åŒ–ç‚¹ã€‚å®ƒå‘Šè¯‰ `CustomPainter`ï¼Œåªè¦ `animation` å¯¹è±¡ï¼ˆå³æˆ‘ä»¬çš„ `_controller`ï¼‰çš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œå°±è‡ªåŠ¨è°ƒç”¨ `paint` æ–¹æ³•ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨ `shouldRepaint` ä¸­ç›´æ¥è¿”å› `false`ï¼Œå› ä¸ºé‡ç»˜çš„è§¦å‘æœºåˆ¶å·²ç»é€šè¿‡ `animation` ç»‘å®šäº†ã€‚
2.  **`_updateAndGenerateBubbles`**:
    *   **æ—¶é—´æ­¥é•¿ `dt`**: ç²¾ç¡®åœ°è®¡ç®—äº†ä¸¤æ¬¡ç»˜åˆ¶ä¹‹é—´çš„æ—¶é—´é—´éš”ï¼Œè¿™å¯¹äºåŸºäºç‰©ç†çš„åŠ¨ç”»ï¼ˆå¦‚æ°”æ³¡ç§»åŠ¨é€Ÿåº¦ï¼‰è‡³å…³é‡è¦ï¼Œç¡®ä¿åŠ¨ç”»åœ¨ä¸åŒå¸§ç‡ä¸‹è¡¨ç°ä¸€è‡´ã€‚
    *   **æ°”æ³¡ç”Ÿæˆ**: ä»¥æ¯ç§’ `spawnRatePerSecond` çš„é€Ÿç‡éšæœºç”Ÿæˆæ°”æ³¡ï¼Œå¹¶æ§åˆ¶æœ€å¤§æ•°é‡ï¼Œé˜²æ­¢ç”Ÿæˆè¿‡å¤šæ°”æ³¡å½±å“æ€§èƒ½ã€‚æ°”æ³¡ä»å±å¹•åº•éƒ¨ç”Ÿæˆï¼Œæ¨¡æ‹Ÿä»æ°´åº•å†’å‡ºçš„æ•ˆæœã€‚
    *   **æ°”æ³¡æ›´æ–°ä¸æ¸…ç†**: éå†ç°æœ‰æ°”æ³¡ï¼Œè°ƒç”¨å®ƒä»¬çš„ `update` æ–¹æ³•æ›´æ–°çŠ¶æ€ï¼Œå¹¶ç§»é™¤å·²ç»â€œæ­»äº¡â€ï¼ˆç§»å‡ºå±å¹•ï¼‰çš„æ°”æ³¡ã€‚
3.  **`paint` æ–¹æ³•**: è¿™æ˜¯ç»˜åˆ¶çš„å…¥å£ã€‚
    *   **æ°´ä½“å åŠ å±‚**: ä½¿ç”¨ä¸€ä¸ªåŠé€æ˜çš„è“è‰²çŸ©å½¢è¦†ç›–æ•´ä¸ªå±å¹•ï¼Œæ¨¡æ‹Ÿæ°´çš„é¢œè‰²å’Œé€æ˜åº¦ï¼Œè®©æ•´ä½“ç”»é¢æ›´åƒâ€œæ°´ä¸‹â€ã€‚
    *   **æ¼©æ¶¡/æ¶Ÿæ¼ªæ•ˆæœ (`_drawSwirl`)**:
        *   è¿™é‡Œè°ƒç”¨äº†ä¸¤æ¬¡ `_drawSwirl`ï¼Œå¹¶ä¼ å…¥ä¸åŒçš„åŠ¨ç”»èµ·å§‹ç‚¹ (`animation.value + 0.0` å’Œ `animation.value + 0.5`) å’Œä¸­å¿ƒä½ç½®ï¼Œåˆ¶é€ å‡ºä¸¤ä¸ªäº¤é”™ã€å¯Œæœ‰å±‚æ¬¡æ„Ÿçš„æ¶Ÿæ¼ªæ•ˆæœã€‚
        *   **ç¼“åŠ¨æ›²çº¿ `Curves.easeOut`**: è®©æ¶Ÿæ¼ªçš„å‡ºç°å’Œæ¶ˆå¤±æ›´è‡ªç„¶ã€‚
        *   **é€æ˜åº¦å’ŒåŠå¾„è®¡ç®—**: æ¶Ÿæ¼ªçš„åŠå¾„éšåŠ¨ç”»è¿›åº¦å¢å¤§ï¼Œé€æ˜åº¦åˆ™å…ˆå¢åŠ åå‡å°ï¼Œæ¨¡æ‹Ÿå‡ºæ‰©æ•£å¹¶é€æ¸æ¶ˆæ•£çš„æ•ˆæœã€‚
        *   **`MaskFilter.blur`**: ä¸ºæ¶Ÿæ¼ªè¾¹ç¼˜æ·»åŠ äº†é«˜æ–¯æ¨¡ç³Šï¼Œä½¿å…¶çœ‹èµ·æ¥æ›´æŸ”å’Œã€æ›´åƒçœŸå®çš„æ°´æ³¢ã€‚
        *   **`canvas.save()/restore()` å’Œ `translate()/rotate()`**: è¿™æ˜¯ `Canvas` ç»˜åˆ¶ä¸­å¸¸ç”¨çš„æŠ€å·§ï¼Œç”¨äºå±€éƒ¨å˜æ¢åæ ‡ç³»ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ç›¸å¯¹åæ ‡ä¸‹ç»˜åˆ¶æ¤­åœ†ï¼Œå†é€šè¿‡æ—‹è½¬å’Œå¹³ç§»å°†å…¶æ”¾ç½®åœ¨æ­£ç¡®çš„ä½ç½®å¹¶äº§ç”Ÿæ—‹è½¬æ•ˆæœã€‚
    *   **æ°”æ³¡ç»˜åˆ¶ (`_drawBubbles`)**: éå†æ‰€æœ‰æ°”æ³¡ï¼Œæ ¹æ®å®ƒä»¬å„è‡ªçš„å±æ€§ç»˜åˆ¶åœ†å½¢ã€‚
4.  **`shouldRepaint`**: è¿”å› `false`ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»é€šè¿‡ `super(repaint: animation)` ç»‘å®šäº†åŠ¨ç”»ç›‘å¬ï¼Œæ— éœ€åœ¨æ­¤å¤„æ‰‹åŠ¨æ£€æŸ¥é‡ç»˜ã€‚åœ¨è¿™è¿”å›falseæé«˜æ€§èƒ½ã€‚

### æ°”æ³¡çš„ç”Ÿå‘½å‘¨æœŸï¼š`_Bubble` ç±»

ä¸ºäº†ç®¡ç†æ¯ä¸ªç‹¬ç«‹çš„æ°”æ³¡ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç§æœ‰çš„è¾…åŠ©ç±» `_Bubble`ã€‚

```dart
/// ç”¨äºç®¡ç†å•ä¸ªæ°”æ³¡çŠ¶æ€çš„è¾…åŠ©ç±»
class _Bubble {
  _Bubble({required this.random, required this.startX, required this.startY}) {
    position = Offset(startX, startY);
    // å°†é€Ÿåº¦å•ä½ä» px/frame è½¬æ¢ä¸º px/second
    speed = (random.nextDouble() * 0.8 + 0.4) * 60.0; // å‡è®¾åŸå…ˆåŸºäº 60fpsï¼Œç°åœ¨è½¬æ¢ä¸ºç§’é€Ÿ
    initialRadius = random.nextDouble() * 3.0 + 1.0; // åˆå§‹åŠå¾„
    maxRadius = initialRadius + random.nextDouble() * 4.0; // æœ€å¤§åŠå¾„
    swayFactor = (random.nextDouble() - 0.5) * 2.0; // æ‘‡æ‘†æ–¹å‘å’Œå¹…åº¦ (-1.0 åˆ° 1.0)
    swayFrequency = random.nextDouble() * 2.0 + 1.0; // æ‘‡æ‘†é¢‘ç‡
  }

  final Random random;
  final double startX;
  final double startY;

  late Offset position; // å½“å‰ä½ç½®
  late double speed; // ä¸Šå‡é€Ÿåº¦
  late double initialRadius; // åˆå§‹åŠå¾„
  late double maxRadius; // æœ€å¤§åŠå¾„
  late double swayFactor; // å·¦å³æ‘‡æ‘†å¹…åº¦å› å­
  late double swayFrequency; // å·¦å³æ‘‡æ‘†é¢‘ç‡

  double radius = 0; // å½“å‰åŠå¾„
  double opacity = 0; // å½“å‰é€æ˜åº¦
  bool isDead = false; // æ˜¯å¦æ­»äº¡ï¼Œå¾…ç§»é™¤

  void update(double dt) {
    // å‚ç›´å‘ä¸Šç§»åŠ¨ (åŸºäºæ—¶é—´)
    position = Offset(position.dx, position.dy - speed * dt);

    // è®¡ç®—ç”Ÿå‘½å‘¨æœŸè¿›åº¦ (0.0 to 1.0)ï¼Œ0.0è¡¨ç¤ºåˆšç”Ÿæˆï¼Œ1.0è¡¨ç¤ºå³å°†æ¶ˆå¤±
    final double progress = 1.0 - (position.dy / startY).clamp(0.0, 1.0);

    // æ ¹æ®ç”Ÿå‘½å‘¨æœŸæ›´æ–°å±æ€§
    opacity = (1.0 - progress) * 0.8; // ç¦»åº•éƒ¨è¶Šè¿œè¶Šé€æ˜ï¼Œæœ€ç»ˆå®Œå…¨é€æ˜
    radius = initialRadius + (maxRadius - initialRadius) * progress; // ç¦»åº•éƒ¨è¶Šè¿œè¶Šå¤§

    // æ°´å¹³æ‘‡æ‘†ï¼šä½¿ç”¨sinå‡½æ•°æ¨¡æ‹Ÿè‡ªç„¶æ‘†åŠ¨
    position = Offset(
      startX + sin(progress * pi * swayFrequency) * 15 * swayFactor,
      position.dy,
    );

    // æ ‡è®°ä¸ºå¯ç§»é™¤
    if (position.dy < -maxRadius) { // æ°”æ³¡å®Œå…¨ç§»å‡ºå±å¹•é¡¶éƒ¨
      isDead = true;
    }
  }
}
```

`_Bubble` ç±»çš„æ ¸å¿ƒï¼š

1.  **éšæœºæ€§**: æ¯ä¸ªæ°”æ³¡åœ¨ç”Ÿæˆæ—¶éƒ½æ‹¥æœ‰ä¸åŒçš„åˆå§‹é€Ÿåº¦ã€åŠå¾„ã€æ‘‡æ‘†å¹…åº¦å’Œé¢‘ç‡ï¼Œè¿™ä½¿å¾—æ°”æ³¡ç¾¤çœ‹èµ·æ¥æ›´è‡ªç„¶ã€ä¸é‡å¤ã€‚
2.  **`update(double dt)`**:
    *   **å‚ç›´ç§»åŠ¨**: `position.dy - speed * dt` ç¡®ä¿æ°”æ³¡ä»¥æ’å®šçš„é€Ÿåº¦ï¼ˆæ ¹æ® `dt` è°ƒæ•´ï¼‰å‘ä¸Šç§»åŠ¨ã€‚
    *   **ç”Ÿå‘½å‘¨æœŸè¿›åº¦ `progress`**: é€šè¿‡æ°”æ³¡å½“å‰çš„ `dy` ä½ç½®ç›¸å¯¹äºèµ·å§‹ `startY` çš„æ¯”ä¾‹æ¥è®¡ç®—ç”Ÿå‘½å‘¨æœŸè¿›åº¦ï¼Œ0è¡¨ç¤ºåˆšå¼€å§‹ï¼Œ1è¡¨ç¤ºå³å°†ç»“æŸã€‚
    *   **é€æ˜åº¦ä¸åŠå¾„å˜åŒ–**:
        *   `opacity = (1.0 - progress) * 0.8;` è®©æ°”æ³¡åœ¨ä¸Šå‡è¿‡ç¨‹ä¸­é€æ¸å˜æ·¡ã€‚
        *   `radius = initialRadius + (maxRadius - initialRadius) * progress;` è®©æ°”æ³¡åœ¨ä¸Šå‡è¿‡ç¨‹ä¸­é€æ¸å˜å¤§ï¼Œæ¨¡æ‹ŸçœŸå®æ°”æ³¡åœ¨æ°´ä¸­å‹åŠ›å‡å°è€Œè†¨èƒ€çš„ç°è±¡ã€‚
    *   **æ°´å¹³æ‘‡æ‘†**: `sin(progress * pi * swayFrequency) * 15 * swayFactor` åˆ›é€ äº†æ°”æ³¡å·¦å³æ‘‡æ‘†çš„æ•ˆæœã€‚`sin` å‡½æ•°çš„å‘¨æœŸæ€§ç‰¹æ€§éå¸¸é€‚åˆæ¨¡æ‹Ÿè¿™ç§è‡ªç„¶çš„å¾€å¤è¿åŠ¨ï¼Œ`swayFrequency` æ§åˆ¶æ‘‡æ‘†çš„é€Ÿåº¦ï¼Œ`swayFactor` æ§åˆ¶æ‘‡æ‘†çš„å¹…åº¦ã€‚
    *   **æ­»äº¡æ ‡è®°**: å½“æ°”æ³¡å®Œå…¨ç§»å‡ºå±å¹•é¡¶éƒ¨æ—¶ï¼Œæ ‡è®°ä¸º `isDead`ï¼Œç­‰å¾…è¢« `RipplePainter` ç§»é™¤ã€‚

### å®Œæ•´ä»£ç 

æ”¾åœ¨ `Stack` çš„é¡¶å±‚å³å¯

```dart
import 'package:flutter/material.dart';
import 'package:your_app_name/ripple_effect.dart'; // å¯¼å…¥ä½ çš„RippleEffectæ–‡ä»¶

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      home: Scaffold(
        appBar: AppBar(title: const Text('Flutter é±¼ç¼¸æ•ˆæœ')),
        body: Stack(
          children: const [
            RippleEffect(), // å°†æ°´æ³¢å’Œæ°”æ³¡æ•ˆæœæ”¾ç½®åœ¨åº•å±‚
            Center(
              child: Text(
                'æ°´é¢æ³¢å…‰ç²¼ç²¼ï¼Œæ°”æ³¡ç¼“ç¼“ä¸Šå‡...',
                style: TextStyle(
                  color: Colors.white,
                  fontSize: 24,
                  fontWeight: FontWeight.bold,
                  shadows: [
                    Shadow(blurRadius: 5, color: Colors.black54, offset: Offset(2, 2))
                  ]
                ),
                textAlign: TextAlign.center,
              ),
            ),
            // ä½ å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ›´å¤šçš„UIå…ƒç´ ï¼Œå®ƒä»¬ä¼šæµ®åœ¨æ•ˆæœä¹‹ä¸Š
          ],
        ),
      ),
    );
  }
}

```
